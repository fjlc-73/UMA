clear all;
d(:,:,1)=[1 1 -1 -1 -1 1 1; 
1 1 -1 1 -1 1 1;
1 1 -1 1 -1 1 1;
1 1 -1 1 -1 1 1;
1 -1 -1 -1 -1 -1 1;
1 -1 1 1 1 -1 1;
1 -1 1 1 1 -1 1;
1 -1 1 1 1 -1 1;
-1 -1 1 1 1 -1 -1;];
d(:,:,2)=[1 -1 -1 -1 -1 -1 1; 
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 -1 -1 -1 -1 1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 -1 -1 -1 -1 1;];
d(:,:,3)=[1 -1 -1 -1 -1 -1 -1; 
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
1 -1 -1 -1 -1 -1 -1;];
d(:,:,4)=[1 -1 -1 -1 -1 -1 1; 
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 1 1 1 1 -1;
1 -1 -1 -1 -1 -1 1;];
d(:,:,5)=[-1 -1 -1 -1 -1 -1 -1; 
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 -1 -1 -1 -1 -1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 1 1 1 1 1 1;
-1 -1 -1 -1 -1 -1 -1;];

W = zeros(9*7,9*7);
dVect = zeros(5,9*7);
for i=1:5
    dVect(i,:)=reshape(d(:,:,i),1,9*7);
    W = W + dVect(i,:)'*dVect(i,:);
end

W = (1/size(W,1))*W;
W = W-diag(diag(W));

S = zeros(size(dVect,2),21);
S(:,1) = reshape(d(:,:,3),9*7,1);%Valor de entrada a la red

for t=2:21
    cambio=false;
    S(:,t) = S(:,t-1);
    for i=1:size(dVect,2)
        h = W(i,:)*S(:,t);
        S(i,t)=(h>0)*2-1;
        cambio = cambio || S(i,t) ~= S(i,t-1);
    end
    if ~cambio
        reshape(S(:,t-1),9,7)
        return
    end
end